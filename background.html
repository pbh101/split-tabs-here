<html>
<head>
<script>
  function halfScreenWidth() {
    return screen.width/2;
  }

  function makeMoveTabs(targetWindow, currentTab) {
    return function(tabs) {
      tabCount = tabs.length;
      var callback = function(){};
      for(i = currentTab.index ; i < tabCount ; i++) {
        chrome.tabs.move(tabs[i].id, {"windowId": targetWindow.id, "index": i-currentTab.index}, callback);
      }
    }
  }
  
  function makeOnCreateWindow(currentTab, sourceWindow){
    return function(targetWindow) {
      chrome.tabs.getAllInWindow(sourceWindow.id, makeMoveTabs(targetWindow, currentTab));
    } 
  }
  
  function makeOnGetCurrentWindow(currentTab) {
    return function(sourceWindow) {
        chrome.windows.create({"left":halfScreenWidth(), "width":halfScreenWidth() },
          makeOnCreateWindow(currentTab, sourceWindow));
        chrome.windows.update(sourceWindow.id, {"left":0, "width":halfScreenWidth() });
    }
  }

  function onTabGotten(currentTab) {
    chrome.windows.getCurrent(
      makeOnGetCurrentWindow(currentTab));  
  }
  
  chrome.browserAction.onClicked.addListener(function() { chrome.tabs.getSelected(null, onTabGotten); });
</script>
</head>
</html>
